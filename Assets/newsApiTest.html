
<!DOCTYPE html>

<!-- THE HTML CODE BELOW IS USED TO TEST THE NEWS API & MUST BE REMOVED UPON INTEGRATION -->

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Financial News Test</title>
        <!-- Use Bootstrap-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <!-- Use Font Awesome-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" />
    </head>
    
    <body>
        <div id="pageTitle">
            <h1>Top News Results</h1>
            <button>Wesfarmers</button> 
            <button>BHP</button> 
            <button>CSL</button> 
            <button>Qantas</button> 
            <button>ASX News</button> 
            <hr>
            <div id="resultsSection"></div>
        </div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript">
  // <!-- THE HTML CODE ABOVE IS USED TO TEST THE NEWS API & MUST BE REMOVED UPON INTEGRATION -->

        $(document).ready(() => {
    
        var shareName = "ASX News"; // default  = "ASX News"
        
        $(document).on("click","button", function () { // when share button is clicked
            $('#resultsSection').empty();
            shareName = $(this).html();
            getNews(shareName);
        });

        function getNews (shareName) {
        
        var searchTermQualifier = "";
        var newsSourceList = ["Fool.com.au", "Australian Financial Review", "Savings.com.au", "Sbs.com", "News.com.au", "9news.com.au", "Perthnow.com.au", "abc-news-au", "7news.com.au", "Heraldsun.com.au"];
        // NEWS API 
        var queryURL = 'https://newsapi.org/v2/everything?' + //api return everthing and not just headlines
        'q=' + shareName + ' ' + searchTermQualifier + '&' +
        'language=en&' + // language is english
        'sortBy=publishedAt&' + // latest news first
        'source=au&' + // Australian news sources only
        'pageSize=30&' + // limit results to 30
        'apiKey=87ce1bad23e546ef86515ee0e5175029';
        var settings = {
            url: queryURL,
            method: "GET"
        }
        
        $.ajax(settings).done(function (response) {
            
            var relevantResult = false;
            var count = 0;
           
            if (response.totalResults > 0) {
                
                for(var i=0; i< response.articles.length; i++) {
                    
                    if ( newsSourceList.includes(response.articles[i].source.name) ) {
                        console.log (newsSourceList.includes(response.articles[i].source.name));
                        relevantResult = true;
                        count++;
                        //GET title 
                        var title = response.articles[i].title;
                        var titleEl = $('<a>').text(title);
                        var urlSource = response.articles[i].url
                        titleEl.attr('href', urlSource );
                        titleEl.attr('target', '_blank');
                        
                        //GET descripition
                        var description = response.articles[i].description;
                        var descriptionEl = $('<p>').text(description);
                        
                        // GET news content snippet
                        var content = response.articles[i].content;
                        content = content.substring(0,260); // truncate and limit to first 260 chars including spaces
                        var contentEl = $('<p>').text(content);

                        //GET Author
                        var author = response.articles[i].author;
                        var authorEl = $('<p>').text(author);

                        //GET publish date time
                        var publishedAt = response.articles[i].publishedAt;
                        publishedAt = new Date(publishedAt).toDateString(); // reformat date time
                        var publishedAtEl = $('<p>').text(publishedAt);
                        
                        //GET image url
                        var urlImage = response.articles[i].urlToImage;
                        var imageEl = $('<img>').attr("src", urlImage);
                        imageEl.css( //thumbnail styling
                            {
                                "border": "1px solid #ddd", /* Gray border */
                                "border-radius": "4px",  /* Rounded border */
                                "padding":"5px", /* Some padding */
                                "margin":"5px", /* Some padding */
                                "width": "150px" /* Set a small width */
                            });
                        

                        // DISPLAY HTML elements to DOM
                        
                        $('#resultsSection').append(imageEl,titleEl,contentEl,authorEl,publishedAtEl,'<hr>');
                
                        if (count === 10){// limit relevant results to 10
                            break; 
                        } 
                    } 
                }
                if (!relevantResult) {
                    var noNewsMessage = $('<p>').text("...Sorry, no relevant business news on '" + shareName + "' at the moment.");
                    $('#resultsSection').append(noNewsMessage);
                    return
                }   

            } else {
                var noNewsMessage = $('<p>').text('...Sorry, no latest business news on ' + shareName + ' at the moment.');
                $('#noNewsMessage').append(noNewsMessage);
            }   
                
        }); // ajax API call close

        }   // getNews function close

        }); // document ready close
    </script>
  </body>
</html>
